{"version":3,"sources":["../src/index.js"],"names":["uri","process","env","MONGO_CONNECTION_URL","mongoConfig","useNewUrlParser","useCreateIndex","MONGO_USER_NAME","MONGO_PASSWORD","auth","authSource","user","pass","mongoose","connect","connection","on","error","console","log","exit","set","app","server","require","Server","io","listen","gameManager","GameManager","setup","port","PORT","use","bodyParser","urlencoded","extended","json","credentials","origin","CORS_ORIGIN","get","passport","authenticate","session","request","response","status","express","path","join","__dirname","send","routes","passwordRoutes","secureRoutes","message","next"],"mappings":"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","sourcesContent":["import 'dotenv/config';\r\nimport path from 'path';\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport cors from 'cors';\r\nimport cookieParser from 'cookie-parser';\r\nimport mongoose from 'mongoose';\r\nimport passport from 'passport';\r\n\r\nimport routes from './routes/main';\r\nimport passwordRoutes from './routes/password';\r\nimport secureRoutes from './routes/secure';\r\nimport GameManager from './game_manager/GameManager';\r\n\r\n// setup mongo connection\r\nconst uri = process.env.MONGO_CONNECTION_URL;\r\nconst mongoConfig = {\r\n  useNewUrlParser: true,\r\n  useCreateIndex: true,\r\n};\r\nif (process.env.MONGO_USER_NAME && process.env.MONGO_PASSWORD) {\r\n  mongoConfig.auth = { authSource: 'admin' };\r\n  mongoConfig.user = process.env.MONGO_USER_NAME;\r\n  mongoConfig.pass = process.env.MONGO_PASSWORD;\r\n}\r\nmongoose.connect(uri, mongoConfig);\r\n\r\nmongoose.connection.on('error', (error) => {\r\n  console.log(error);\r\n  process.exit(1);\r\n});\r\n\r\nmongoose.set('useFindAndModify', false);\r\n\r\nconst app = express();\r\nconst server = require('http').Server(app);\r\nconst io = require('socket.io').listen(server);\r\n\r\nconst gameManager = new GameManager(io);\r\ngameManager.setup();\r\n\r\nconst port = process.env.PORT || 3000;\r\n\r\n// update express settings\r\napp.use(bodyParser.urlencoded({ extended: false })); // parse application/x-www-form-urlendcoded\r\napp.use(bodyParser.json()); // parse application/json\r\napp.use(cookieParser());\r\napp.use(cors({ credentials: true, origin: process.env.CORS_ORIGIN }));\r\n\r\n// require passport auth\r\nrequire('./auth/auth');\r\n\r\napp.get('/game.html', passport.authenticate('jwt', { session: false }), (request, response) => {\r\n  response.status(200).json(request.user);\r\n});\r\n\r\napp.use(express.static(path.join(__dirname, '/../public')));\r\n\r\napp.get('/', (request, response) => {\r\n  response.send(path.join(__dirname, '/../index.html'));\r\n});\r\n\r\n// setup routes\r\napp.use('/', routes);\r\napp.use('/', passwordRoutes);\r\napp.use('/', passport.authenticate('jwt', { session: false }), secureRoutes);\r\n\r\n// catch all other routes\r\napp.use((request, response) => {\r\n  response.status(404).json({ message: '404 - Not Found', status: 404 });\r\n});\r\n\r\n// handle errors\r\n// eslint-disable-next-line no-unused-vars\r\napp.use((error, request, response, next) => {\r\n  console.log(error);\r\n  response.status(error.status || 500).json({ error: error.message, status: 500 });\r\n});\r\n\r\nmongoose.connection.on('connected', () => {\r\n  console.log('connceted to mongo');\r\n  server.listen(port, () => {\r\n    console.log(`server is running on port: ${port}`);\r\n  });\r\n});\r\n"],"file":"index.js"}